
<!-- indexer::stop -->
<div class="<?php echo $this->class; ?> block"<?php echo $this->cssID; ?><?php if ($this->style): ?> style="<?php echo $this->style; ?>"<?php endif; ?>>
<?php if ($this->headline): ?>

<<?php echo $this->hl; ?>><?php echo $this->headline; ?></<?php echo $this->hl; ?>>
<?php endif; ?>

<?php if (is_array($this->steps) && count($this->steps)): ?>
<div class="steps block">
<ol class="level_1 steps<?php echo count($this->steps); ?>">
<?php $i=0; foreach( $this->steps as $step ): ?>
<li class="<?php echo $step['class']; ?>">
<?php if (strlen($step['href'])): ?>
<a class="<?php echo $step['class']; ?>" href="<?php echo $step['href']; ?>" title="<?php echo $step['title']; ?>">
  <span class="steptext"><?php echo $step['link']; ?></span>
</a>
<?php else: ?>
<span class="<?php echo $step['class']; ?>"><?php if($step['isActive']): ?><span class="invisible"><?php echo $this->activeStep; ?></span><?php endif; ?><?php echo $step['link']; ?></span>
<?php endif; ?>
</li>
<?php $i++; endforeach; ?>
</ol>
</div>
<?php endif; ?>

<?php if (strlen($this->message)): ?>
<p class="<?php echo $this->mtype; ?> message"><?php echo $this->message; ?></p>
<?php endif; ?>

<?php if ($this->showForm): ?>
<form action="<?php echo $this->action; ?>" id="<?php echo $this->formId; ?>" method="post" enctype="<?php echo $this->enctype; ?>" novalidate="novalidate">
<div class="formbody">
<input type="hidden" name="FORM_SUBMIT" value="<?php echo $this->formSubmit; ?>">
<input type="hidden" name="REQUEST_TOKEN" value="{{request_token}}">
<?php echo $this->hidden; ?>
<?php endif; ?>
<?php foreach ($this->fields as $field): ?>
<div id="<?php echo $field['id']; ?>" class="<?php echo $field['class']; ?>">
<?php echo $field['html']; ?>
</div>
<?php endforeach; ?>
<?php if ($this->showForm): ?>
</div>
<?php if ($this->showPrevious || $this->showNext): ?>
    <div class="submit_container">
        <?php if ($this->showPrevious): ?><input type="submit" class="submit previous button" name="previousStep" value="<?php echo $this->previousLabel; ?>"><?php endif; if ($this->showNext): ?>
        <input type="submit" class="submit <?php echo $this->nextClass; ?> button" name="nextStep" value="<?php echo $this->nextLabel; ?>"><?php endif; ?>
    </div>
<?php endif; ?>
</form>
<?php endif; ?>

</div>
<script>
IsotopeXCheckout.attach({module: '<?php echo $this->id; ?>', 
                     step:'<?php echo $this->step; ?>', 
                     language: '<?php echo $GLOBALS['TL_LANGUAGE']; ?>',
                     loadMessage: '<?php echo $GLOBALS['TL_LANG']['MSC']['loading_message']; ?>',
                     refreshMessage: '<?php echo $GLOBALS['TL_LANG']['MSC']['refresh_shipping']; ?>',
                     page: '<?php echo $this->pageid; ?>',
                     mode: '<?php echo (TL_MODE=='FE' ? 'FE' : 'BE'); ?>'
                     });
</script>
<!-- indexer::continue -->